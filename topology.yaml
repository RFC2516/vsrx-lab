name: SRX-Security
prefix: ""
mgmt:
  network: clab-network
  ipv4-subnet: 172.25.11.0/24
  ipv6-subnet: 2001:172:25:11::/64
topology:
  nodes:
    vsrx1:
      kind: vr-vsrx
      mgmt-ipv4: 172.25.11.2
      mgmt-ipv6: 2001:172:25:11::2
      image: vrnetlab/vr-vsrx:22.4R1.10
      startup-config: vsrx1.conf
      ports:
        - 8443:443
        - 8080:80
    workstation:
      kind: linux
      mgmt-ipv4: 172.25.11.254
      mgmt-ipv6: 2001:172:25:11::254
      image: amazonlinux:latest
      dns:
        servers:
          - 1.1.1.1
          - 8.8.8.8
      exec:
        - yum update -y
        - yum upgrade -y
        - yum install iproute -y
        - yum install mtr -y
        - yum install bind-utils -y
        - ip addr add 10.25.0.254/24 dev eth1
        - ip route del default
        - ip route add default via 10.25.0.1

    inet:
      kind: linux
      mgmt-ipv4: 172.25.11.50
      mgmt-ipv6: 2001:172:25:11::50
      image: amazonlinux:latest
      dns:
        servers:
          - 1.1.1.1
          - 8.8.8.8
      sysctls:
        net.ipv4.ip_forward: 1
      exec:
        - yum update -y
        - yum upgrade -y
        - yum install iptables -y
        - yum install iproute -y
        - yum install mtr -y
        - yum install bind-utils -y
        - iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
        - iptables -A INPUT -i eth1 -j ACCEPT
        - iptables -A INPUT -i eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT
        - iptables -A OUTPUT -j ACCEPT
        - ip addr add 10.10.10.50/24 dev eth1
        - ip addr add 2001:10:10:10::50/64 dev eth1
  links:
    - endpoints: ['vsrx1:eth1', 'workstation:eth1']
    - endpoints: ['vsrx1:eth2', 'inet:eth1']